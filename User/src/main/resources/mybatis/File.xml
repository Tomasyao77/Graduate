<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.whut.pocket.file.mapper.FileMapper">
    <!--暂时不使用缓存-->
    <!--<cache eviction="LRU" flushInterval="60000" size="1024" readOnly="true"/>-->

    <resultMap id="getFileRM" type="edu.whut.pocket.file.vo.FileVo">
        <id property="id" column="id"/>
        <result property="url" column="url"/>
        <result property="create_time" column="create_time"/>
        <result property="is_deleted" column="is_deleted"/>
        <result property="type" column="type" typeHandler="org.apache.ibatis.type.EnumOrdinalTypeHandler"/>
    </resultMap>

    <select id="getFile" parameterType="int" resultMap="getFileRM">
        select * from file f where f.id=#{0}
    </select>

    <select id="getFilePage" parameterType="hashmap"
            resultMap="getFileRM">
        select * from file f
        <where>
            <if test="id != null and id > 0">f.id=#{id}</if>
            <if test="url != null and url != ''">and f.url like "%"#{url}"%"</if>
            <if test="isDeleted != null and isDeleted >= 0">and f.is_deleted=#{isDeleted}</if>
        </where>
        <if test="order != null and order != ''">order by ${order}</if>
        limit #{firstIndex},#{size}
    </select>

    <select id="findCountFilePage" parameterType="hashmap" resultType="int">
        select count(*) from file f
        <where>
            <if test="id != null and id > 0">f.id=#{id}</if>
            <if test="url != null and url != ''">and f.url like "%"#{url}"%"</if>
            <if test="isDeleted != null and isDeleted >= 0">and f.is_deleted=#{is_deleted}</if>
        </where>
    </select>

    <update id="deleteFile">
        update file f set f.is_deleted=1 where f.id=#{0}
    </update>

</mapper>
