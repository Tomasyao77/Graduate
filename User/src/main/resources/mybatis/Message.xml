<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.whut.pocket.message.mapper.LogMessageMapper">
    <!--暂时不使用缓存-->
    <!--<cache eviction="LRU" flushInterval="60000" size="1024" readOnly="true"/>-->

    <resultMap id="getLogMessageRM" type="edu.whut.pocket.message.model.LogMessage">
        <id property="id" column="id"/>
        <result property="phone" column="phone"/>
        <result property="type" column="type" typeHandler="org.apache.ibatis.type.EnumOrdinalTypeHandler"/>
        <result property="platform" column="platform" typeHandler="org.apache.ibatis.type.EnumOrdinalTypeHandler"/>
        <result property="msg_content" column="msg_content"/>
        <result property="create_time" column="create_time"/>
        <result property="update_time" column="update_time"/>
        <result property="success" column="success"/>
    </resultMap>

    <insert id="addOne" parameterType="edu.whut.pocket.message.model.LogMessage" useGeneratedKeys="true"
            keyProperty="id">
        insert into log_message(phone, type, platform, msg_content, create_time, update_time, success)
        values(#{phone}, #{type, typeHandler=org.apache.ibatis.type.EnumOrdinalTypeHandler},
         #{platform, typeHandler=org.apache.ibatis.type.EnumOrdinalTypeHandler},
         #{msg_content}, #{create_time}, #{update_time}, #{success})
    </insert>

    <select id="getLogMessagePage" parameterType="hashmap"
            resultMap="getLogMessageRM">
        select * from log_message lm
        <where>
            <if test="phone != null and phone != ''">lm.phone like "%"#{phone}"%"</if>
        </where>
        <if test="order != null and order != ''">order by ${order}</if>
        limit #{firstIndex},#{size}
    </select>

    <select id="findCountLogMessagePage" parameterType="hashmap" resultType="int">
        select count(*) from log_message lm
        <where>
            <if test="phone != null and phone != ''">lm.phone like "%"#{phone}"%"</if>
        </where>
    </select>

</mapper>
